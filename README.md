# Macquarie Bank to Firefly III Auto-Importer

A self-hosted, Dockerized application to automate the downloading of transaction CSVs from Macquarie Bank and importing them into [Firefly III](https://www.firefly-iii.org/) via the [Data Importer](https://docs.firefly-iii.org/data-importer/).

Designed for **Unraid** (and standard Docker environments) with a focus on security and reliability.

## Features

- **Hybrid Automation**: Uses a headful browser (Puppeteer) visible via VNC. You perform the login manually (handling 2FA/Trust), and the bot takes over to scrape data.
- **Configurable Selectors**: If the bank changes its website layout, you can update the CSS selectors directly from the UI without waiting for an app update.
- **Visual Selector Testing**: "Highlight" feature in settings lets you verify your selectors against the live banking site.
- **Firefly III Integration**: Automatically uploads downloaded CSVs to your Firefly Data Importer instance.
- **Docker & Unraid Ready**: Pre-configured for Unraid with an XML template.

## Prerequisites

- **Firefly III** installed and running.
- **Firefly III Data Importer** installed and running.
- **Unraid** (optional, but recommended platform).

## Installation

### On Unraid

1.  Copy the `macquarie-importer.xml` file to your Unraid Docker templates folder (usually `/boot/config/plugins/dockerMan/templates-user/`) or manually add a container using the values in the XML.
2.  **Ports**:
    - `3000`: Web UI (Dashboard)
    - `6080`: VNC Viewer (Browser View)
3.  **Volumes**:
    - `/config`: Map to a persistent appdata folder (e.g., `/mnt/user/appdata/macquarie-importer/config`).
    - `/downloads`: Map to a folder (optional, mainly for internal use).

### On Standard Docker

```bash
docker build -t macquarie-importer .
docker run -d \
  -p 3000:3000 \
  -p 6080:6080 \
  -v $(pwd)/config:/config \
  --name macquarie-importer \
  macquarie-importer
```

## Usage Guide

1.  **Open the Web UI** (http://YOUR-SERVER:3000).
2.  **Settings Setup**:
    - Go to the **Settings** tab.
    - Enter your **Firefly Importer URL** (e.g., `http://firefly-importer:8080`) and **Auto Import Secret**.
    - Configure **CSS Selectors** if the defaults don't work (see below).
3.  **Account Mapping**:
    - You will need a JSON configuration file for each bank account, generated by the Firefly Importer.
    - Upload these files (or place them in the config folder) and map them to your Bank Account Names in the Settings (feature to come: UI for mapping). *Current workaround: Edit `/config/settings.json` manually to add account mappings.*
4.  **Start Import**:
    - Go to **Dashboard**.
    - Click **Launch Browser**.
    - The VNC view will show the browser. **Log in to Macquarie Bank manually.**
    - Once you see the account list, enter a Date Range (DD/MM/YYYY) in the Dashboard.
    - Click **Start Import**.
    - Watch the **Logs** tab for progress.

## Troubleshooting & Selectors

If the bot fails to find elements (e.g., "Account list not found"), the bank's website might have changed.

1.  Open the App and Launch Browser.
2.  Log in.
3.  Right-click "Inspect" (might be limited in VNC) or use your local browser to find the new CSS Class/ID of the element.
4.  Go to **Settings**.
5.  Update the selector field.
6.  Click **Highlight** to see if the element gets a red border in the VNC view.
7.  Save Configuration.

## Development

- **Backend**: Node.js, Express, Puppeteer.
- **Frontend**: React, Vite, Material UI.
- **Container**: Custom image with Node, Chromium, Xvfb, x11vnc, noVNC.

See `package.json` in `src/backend` and `src/frontend` for scripts.
